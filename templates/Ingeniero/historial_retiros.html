{% extends "base.html" %}

{% block title %}Historial de Retiros{% endblock %}

{% block content %}

  <!-- Bot√≥n para volver al dashboard -->
  <div style="margin-bottom: 20px;">
    <a href="{{ url_for('ingeniero.dashboard') }}" class="btn-volver">‚Üê Volver al dashboard</a>
  </div>

  <h2>Historial de Retiros</h2>

  {% if movimientos %}
    <table>
      <thead>
        <tr>
          <th>Material</th>
          <th>Cantidad</th>
          <th>Fecha</th>
          <th>Estado</th>
          <th>Observaci√≥n del almacenista</th>
        </tr>
      </thead>
      <tbody>
        {% for mov in movimientos %}
          <tr style="
            {% if mov.tipo == 'DEVOLUCION' %}
              background-color: #fff3cd;
            {% elif mov.estado == 'RECHAZADO' %}
              background-color: #f8d7da;
            {% elif mov.estado == 'AUTORIZADO' %}
              background-color: #d4edda;
            {% endif %}
          ">
            <td>
              {% if mov.tipo == 'DEVOLUCION' %}
                ‚ôªÔ∏è {{ mov.material.nombre }}
              {% else %}
                üì§ {{ mov.material.nombre }}
              {% endif %}
            </td>
            <td>{{ mov.cantidad|formatear_numero }}</td>
            <td>{{ mov.fecha_local.fecha }} {{ mov.fecha_local.hora }}</td>
            <td>
              {% if mov.tipo == 'DEVOLUCION' %}
                {% if mov.estado == 'AUTORIZADO' %}
                  <span style="color: green;">‚ôªÔ∏è Devoluci√≥n aceptada</span>
                {% elif mov.estado == 'RECHAZADO' %}
                  <span style="color: red;">‚ôªÔ∏è Devoluci√≥n rechazada</span>
                {% else %}
                  <span style="color: orange;">‚ôªÔ∏è Devoluci√≥n pendiente</span>
                {% endif %}
              {% else %}
                {% if mov.estado == 'PENDIENTE' %}
                  <span style="color: orange;">üì§Retiro de material pendiente</span>
                {% elif mov.estado == 'AUTORIZADO' %}
                  <span style="color: green;">üì§Retiro de material autorizado</span>
                {% elif mov.estado == 'RECHAZADO' %}
                  <span style="color: red;">üì§Retiro de material rechazado</span>
                {% else %}
                  {{ mov.estado }}
                {% endif %}
              {% endif %}
            </td>
            <td>{{ mov.observacion_almacenista or 'Sin observaci√≥n' }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>No hay retiros registrados.</p>
  {% endif %}

{% endblock %}