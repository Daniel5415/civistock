{% extends "base.html" %}

{% block title %}Editar Usuario{% endblock %}

{% block content %}
  <h2>Editar Usuario</h2>

  <div class="actions-bar">
    <a href="{{ url_for('admin.listar_usuarios') }}" class="btn btn-secondary">
      <i class="fas fa-arrow-left"></i> Volver a Lista de Usuarios
    </a>
  </div>

  <form method="POST" enctype="multipart/form-data" class="user-form">
    <label>Username</label>
    <input type="text" name="username" value="{{ usuario.username }}" required readonly>

    <label>Nombre completo</label>
    <input type="text" name="nombre" value="{{ usuario.nombre }}" required>

    <label>Contrase√±a (deja en blanco si no deseas cambiarla)</label>
    <input type="text" name="password">

    <label>Rol</label>
    <select name="rol" required>
      <option value="ADMIN" {% if usuario.rol == 'ADMIN' %}selected{% endif %}>ADMIN</option>
      <option value="ALMACENISTA" {% if usuario.rol == 'ALMACENISTA' %}selected{% endif %}>ALMACENISTA</option>
      <option value="INGENIERO" {% if usuario.rol == 'INGENIERO' %}selected{% endif %}>INGENIERO</option>
    </select>

    <label>Foto actual</label><br>
    {% if usuario.foto %}
      {% set foto_url = url_for('static', filename='uploads/' + usuario.foto) %}
    {% else %}
      {% set foto_url = url_for('static', filename='uploads/default.png') %}
    {% endif %}
    <img src="{{ foto_url }}" alt="Foto de {{ usuario.nombre }}" width="100">

    <label>Actualizar foto (opcional)</label>
    <input type="file" name="foto">

    <button type="submit" class="btn btn-success">
      <i class="fas fa-save"></i> Actualizar
    </button>
  </form>

  <!-- FLASH MESSAGES -->
  <div class="flash-messages">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        <ul class="flashes">
          {% for category, message in messages %}
            <li class="{{ category }}">{{ message }}</li>
          {% endfor %}
        </ul>
      {% endif %}
    {% endwith %}
  </div>
{% endblock %}
